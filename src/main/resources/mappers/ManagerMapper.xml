<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kh.tableup.dao.ManagerDAO">

	<insert id="insertManager">
		insert into restaurantmanager (rm_id, rm_pw, rm_email, rm_name, rm_phone, rm_business)
		values (#{rm_id},#{rm_pw},#{rm_email},#{rm_name},#{rm_phone},#{rm_business})
	</insert>

	<select id="findById" resultType="RestaurantManagerVO">
		select * from restaurantmanager where rm_id=#{username}
	</select>

	<select id="selectManager" resultType="RestaurantManagerVO">
		select * from restaurantmanager where rm_id=#{rm_id}
	</select>

	<select id="selectRestaurant" resultType="RestaurantVO">
		select * from restaurant 
		join restaurantmanager on rm_rt_num = rt_num
		where rm_num=#{rm_num}
	</select>

	<select id="selectFoodCategoryList" resultType="FoodCategoryVO">
		select * from foodcategory
	</select>

	<select id="selectRegionList" resultType="RegionVO">
		select * from region
	</select>

	<select id="selectDetailFoodList" resultType="DetailFoodCategoryVO">
		select * from detailfoodcategory
	</select>

	<select id="selectDetailRegionList" resultType="DetailRegionVO">
		select * from detailregion
	</select>

	<select id="selectDetailByFcNum" resultType="DetailFoodCategoryVO">
		select * from detailfoodcategory where dfc_fc_num=#{fc_num}
	</select>

	<select id="selectDetailByRegNum" resultType="DetailRegionVO">
		select * from detailregion where dreg_reg_num=#{reg_num}
	</select>

	<!--레스토랑 테이블에 값들을 입력-->
	<insert id="insertRestaurant" useGeneratedKeys="true" keyProperty="rt_num">
		insert into restaurant
			(rt_name, rt_closed_days, rt_price_lunch, rt_price_dinner,
			 rt_accept, rt_dfc_num, rt_dreg_num, rt_description)
		value(#{rt_name},#{rt_closed_days},#{rt_price_lunch},#{rt_price_dinner}
					,'N',#{rt_dfc_num},#{rt_dreg_num},#{rt_description})
	</insert>

	<update id="updateManagerRtNum">
		update restaurantmanager set rm_rt_num=#{rt_num}
		where rm_num=#{rm_num}
	</update>

	<select id="selectMenuList" resultType="MenuVO">
		select * from `menu` where mn_rt_num=#{rt_num}
	</select>

	<select id="selectMenuTypeList" resultType="MenuTypeVO">
		select * from menutype
	</select>

	<insert id="insertMenu" useGeneratedKeys="true" keyProperty="mn_num">
		insert into `menu`(mn_name, mn_price, mn_content, mn_mt_num, mn_rt_num, mn_div)
		value(#{mn_name}, #{mn_price}, #{mn_content}, #{mn_mt_num}, #{mn_rt_num}, #{mn_div})
	</insert>

	<update id="updateMenu">
		update `menu` set	
						mn_name=#{mn_name},
						<choose>
							<when test="mn_img == null">
								mn_img=mn_img,
							</when>
							<otherwise>
								mn_img=#{mn_img},
							</otherwise>
						</choose>
						mn_price=#{mn_price},
						mn_content=#{mn_content},
						mn_mt_num=#{mn_mt_num},
						mn_rt_num=#{mn_rt_num},
						mn_div=#{mn_div}
	where mn_num=#{mn_num}
	</update>

	<select id="selectMenu" resultType="MenuVO">
		select * from `menu` where mn_num=#{mn_num}
	</select>

	<select id="selectMenuType" resultType="MenuTypeVO">
		select * from `menutype` where mt_num=#{mn_mt_num}
	</select>
</mapper>