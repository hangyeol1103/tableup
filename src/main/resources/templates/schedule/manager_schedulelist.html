<!DOCTYPE html>
<html 
lang="en" 
xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
layout:decorate="~{layout/manager_layout.html}"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security" >
<head>
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<title>테이블업 - 매니저페이지 - 매장 일정 관리</title>

<style>

</style>
</head>
<body>
	<main layout:fragment="content">
		<!-- 매장 정보가 등록이 되어 있으면-->
		<h2>매장 일정 관리</h2>
        <div th:if="${restaurant != null}">
            <table class="table table-bordered text-center align-middle">
                <thead>
                    <tr>
                        <th>시간</th>
                        <th th:each="date : ${dateList}"
                            th:text="${#temporals.format(date, 'yyyy년 MM월 dd일 (E)')}">
                        </th>
                    </tr>
                </thead>
                <tbody>
                     <tr th:each="time : ${timeList}">
                        <td th:text="${#temporals.format(time, 'HH:mm')}"></td>

                        <td th:each="date : ${dateList}"   th:with="key=${#temporals.format(date,'yyyy-MM-dd')}, bd=${businessDateMap[key.toString()]}">
                            <div th:if="${bd == null}">
                                <!-- 등록 안된 날짜 -->
                                <div th:if="${bd == null}">
                                    <span class="text-secondary">미등록</span>
                                </div>
                                <!-- 등록된 날짜 -->
                                <div th:if="${bd != null}">
                                    <!-- 쉬는 날 -->
                                    <div th:if="${bd.bd_off}">
                                        <span class="text-danger fw-bold">쉬는 날</span>
                                    </div>
                                    <!-- 영업일 -->
                                    <div th:unless="${bd.bd_off}" th:with="
                                        open=${#dates.format(bd.bd_open, 'HH:mm')},
                                        close=${#dates.format(bd.bd_close, 'HH:mm')}, 
                                        brStart=${#dates.format(bd.bd_brstart, 'HH:mm')},
                                        brEnd=${#dates.format(bd.bd_brend, 'HH:mm')},
                                        curTime=${#temporals.format(time, 'HH:mm')}">
                                        <span th:if="${curTime < open or curTime >= close}" class="text-muted">-</span>
                                        <span th:if="${curTime >= brStart and curTime < brEnd}" class="text-warning">브레이크</span>
                                        <span th:if="${curTime >= open and curTime < close and (curTime < brStart or curTime >= brEnd)}">      
                                        </span>
                                    </div>
                                    
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
		</div>
		<!-- 매장 정보가 등록이 되어 있지 않으면-->
		<div th:unless="${restaurant != null}">
			<h3>아직 식당정보를 입력하지 않앗습니다.</h3>
		</div>
		<button type="button" class="btn btn-outline-success col-12 mb-3" onclick="location.href='/schedule/make_schetime'">일정등록</button>
	</main>
</body>
</html>