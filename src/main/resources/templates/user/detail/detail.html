<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layout.html}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!--  Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <!--  Flatpickr CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <!--  Flatpickr JS + 한글 -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

    <title>식당 리스트</title>
    <style>
      #calendar-wrapper .flatpickr-calendar.inline {
        display: inline-block;
      }
    </style>
  </head>

  <body>
    <main layout:fragment="content" class="container">
      <div class="row text-center">
        <div class="col-1 border">1</div>
        <div class="col-1 border">2</div>
        <div class="col-1 border">3</div>
        <div class="col-1 border">4</div>
        <div class="col-1 border">5</div>
        <div class="col-1 bg-warning border">6</div>
        <div class="col-1 bg-warning border">7</div>
        <div class="col-1 border">8</div>
        <div class="col-1 border">9</div>
        <div class="col-1 border">10</div>
        <div class="col-1 border">11</div>
        <div class="col-1 border">12</div>
      </div>

      <div class="row">
        <div class="col-7 offset-1">
          <div class="container bg-light py-4">
            <img
              src="/img/index/index4.jpg"
              class="img-fluid rounded-4 shadow-sm"
              style="
                width: 100%;
                height: 400px;
                object-fit: cover;
                margin-bottom: 10px;
              "
            />
            <ul class="list-group bg-white rounded shadow-sm p-3">
              <li class="list-group-item border-0 ps-3 fw-bold py-0">
                <span class="text-secondary">대분류 | 소분류 | 태그</span>
              </li>
              <li
                class="list-group-item border-0 ps-3 fw-bold py-0 fs-5"
                th:text="${restaurant.rt_name}"
              ></li>
              <li class="list-group-item border-0 ps-3 fw-bold py-0">
                ⭐️ 4.7 • 리뷰 123개 >
              </li>
              <li class="list-group-item border-0 ps-3 py-0">
                가게 설명 텍스트 텍스트 텍스트 텍스트
                <span class="text-secondary">더보기</span>
              </li>
              <hr class="my-2 border-secondary" />
              <li class="list-group-item border-0 d-flex align-items-center">
                <i class="bi bi-geo-alt me-2 text-secondary"></i> 위치
              </li>
              <li class="list-group-item border-0 d-flex align-items-center">
                <i class="bi bi-cash-coin me-2 text-secondary"></i>
                가격 => 점심 :&nbsp;
                <span th:text="${restaurant.rt_price_lunch}"></span>원 / 저녁 :&nbsp;
                <span th:text="${restaurant.rt_price_dinner}"></span>원
              </li>
              <li class="list-group-item border-0 d-flex align-items-center">
                <i class="bi bi-clock me-2 text-secondary"></i> 휴무일 : /
                영업시간 : 오늘 (월) · 17:00 ~ 새벽 02:00
              </li>
              <li class="list-group-item border-0 d-flex align-items-center">
                <button
                  type="button"
                  class="btn btn-warning"
                  style="font-size: 12px; margin-right: 12px"
                >
                  오늘 (요)<br />
                  예약 가능
                </button>
                <button
                  type="button"
                  class="btn btn-warning"
                  style="font-size: 12px; margin-right: 16px"
                >
                  오늘 (요)<br />
                  예약 가능
                </button>
                <button
                  type="button"
                  class="btn btn-warning"
                  style="font-size: 12px; margin-right: 16px"
                >
                  오늘 (요)<br />
                  예약 가능
                </button>
                <button
                  type="button"
                  class="btn btn-warning"
                  style="font-size: 12px; margin-right: 16px"
                >
                  오늘 (요)<br />
                  예약 가능
                </button>
                <button
                  type="button"
                  class="btn btn-warning"
                  style="font-size: 12px; margin-right: 16px"
                >
                  오늘 (요)<br />
                  예약 가능
                </button>
                <button
                  type="button"
                  class="btn btn-warning"
                  style="font-size: 12px; margin-right: 16px"
                >
                  오늘 (요)<br />
                  예약 가능
                </button>
                <button
                  type="button"
                  class="btn btn-warning"
                  style="font-size: 12px; margin-right: 16px"
                >
                  오늘 (요)<br />
                  예약 가능
                </button>
              </li>
            </ul>
            <div class="mt-3 p-3 bg-white rounded shadow-sm">
              <h5 class="fw-bold">공지사항 ></h5>
            </div>
            <div class="mt-3 p-3 bg-white rounded shadow-sm">
              <h5 class="fw-bold">편의시설</h5>
              <p class="mb-0">이곳에 새 정보를 입력하세요.</p>
              <li class="list-group-item border-0 d-flex align-items-center">
                <button type="button" class="btn btn-secondary btn-sm me-2">
                  편의시설
                </button>
                <button type="button" class="btn btn-secondary btn-sm me-2">
                  편의시설
                </button>
                <button type="button" class="btn btn-secondary btn-sm me-2">
                  편의시설
                </button>
                <button type="button" class="btn btn-secondary btn-sm me-2">
                  편의시설
                </button>
              </li>
            </div>
            <div class="mt-3 p-3 bg-white rounded shadow-sm">
              <h5 class="fw-bold">지도 API</h5>
            </div>
            <div class="mt-3 p-3 bg-white rounded shadow-sm">
              <h5 class="fw-bold">메뉴</h5>
            </div>
            <div class="mt-3 p-3 bg-white rounded shadow-sm">
              <h5 class="fw-bold">식당 사진</h5>
              <h6>매장사진, 음식사진</h6>
            </div>
            <div class="mt-3 p-3 bg-white rounded shadow-sm">
              <h5 class="fw-bold">리뷰</h5>
            </div>
            <div class="mt-3 p-3 bg-white rounded shadow-sm">
              <h5 class="fw-bold">상세정보</h5>
              <i class="bi bi-telephone me-2 text-secondary"></i> 02-1234-5678
              <h5 class="fw-bold mt-3">안내 및 유의사항</h5>
              <h6>예약 확정 전 필수 체크사항 및 확인 부탁드립니다.</h6>
              <div class="d-grid mt-3">
                <button
                  type="button"
                  class="btn btn-outline-dark btn-block fw-bold"
                >
                  매장정보 전체보기
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- 우측 -->
        <div class="col-4 mt-3">
          <div class="mt-3 p-3 bg-white rounded shadow">
            <div
              class="mt-2 text-white p-2 rounded mx-auto text-center"
              style="background-color: #4a3f2c; font-size: 1rem; width: 310px"
            >
              <div class="fw-bold">인터넷 예약</div>
              <div>기다릴 필요 없이 바로 실시간 예약</div>
            </div>
            <!-- ✅ 달력이 이 div 안에 상시 표시됨 -->
            <div class="text-center mt-3" id="calendar-wrapper">
              <div id="reservation-calendar"></div>
            </div>

            <!-- <div id="reservation-calendar" class="mt-3"></div> -->
            <!-- 선택한 날짜 보여주고 싶으면 아래 추가 -->
            <p class="fw-bold text-center mt-3">
              선택 날짜: <span id="selected-date">없음</span>
            </p>

            <!-- <hr class="my-2 border-secondary" />
            <p class="fw-bold text-center">인원수&nbsp;&nbsp;X명</p>
            <p class="fw-bold text-center">시간&nbsp;&nbsp;00:00</p> -->
            <div class="px-3">
              <!-- 인원수 선택 -->
              <label for="select-people" class="form-label fw-bold"
                >인원수</label
              >
              <select id="select-people" class="form-select mb-3">
                <option value="1">1명</option>
                <option value="2" selected>2명</option>
                <option value="3">3명</option>
                <option value="4">4명</option>
                <option value="5">5명</option>
                <option value="6">6명</option>
                <option value="7">7명</option>
                <option value="8">8명</option>
                <option value="9">9명</option>
                <option value="10">10명</option>
                <option value="11">11명</option>
                <option value="12">12명</option>
              </select>

              <!-- 시간 선택 -->
              <label for="select-time" class="form-label fw-bold">시간</label>
              <select id="select-time" class="form-select mb-3"></select>
            </div>

            <button
              type="button"
              class="btn btn-warning btn-lg d-block mx-auto"
            >
              예약하기
            </button>
            <button
              type="button"
              class="btn btn-secondary btn-lg d-block mx-auto mt-3"
            >
              빈자리 알림
            </button>
          </div>
        </div>
      </div>
      <script>
        flatpickr("#reservation-calendar", {
          inline: true,
          minDate: "today",
          defaultDate: "today",
          dateFormat: "Y-m-d",
          locale: "ko",

          onReady: function (selectedDates, dateStr, instance) {
            document.getElementById("selected-date").textContent = dateStr;

            // ✅ 달력 헤더: 년 → 월 순서로 재배치
            const monthElement = instance.calendarContainer.querySelector(
              ".flatpickr-current-month"
            );
            if (monthElement) {
              const yearInput = monthElement.querySelector(".numInputWrapper");
              const monthSelect = monthElement.querySelector(
                ".flatpickr-monthDropdown-months"
              );

              if (yearInput && monthSelect) {
                monthElement.insertBefore(yearInput, monthSelect);
              }
            }
          },

          onChange: function (selectedDates, dateStr) {
            document.getElementById("selected-date").textContent = dateStr;
          },
        });

        // 시간 선택 반복문
        const selectTime = document.getElementById("select-time");
        selectTime.innerHTML = ""; // 초기화

        const now = new Date();

        // 현재 시간 + 30분을 기준으로 예약 가능 시간 설정
        const minReservable = new Date(now.getTime() + 30 * 60 * 1000);
        let firstAvailableSelected = false;

        for (let h = 7; h < 31; h++) {
          for (let m of [0, 30]) {
            const realH = h % 24;
            const timeStr = `${String(realH).padStart(2, "0")}:${String(
              m
            ).padStart(2, "0")}`;

            // 시간 비교용 객체
            const timeObj = new Date(now);
            timeObj.setHours(realH, m, 0, 0);

            if (timeObj >= minReservable) {
              const option = document.createElement("option");
              option.value = timeStr;
              option.textContent = timeStr;

              if (!firstAvailableSelected) {
                option.selected = true;
                firstAvailableSelected = true;
              }

              selectTime.appendChild(option);
            }
          }
        }
      </script>
    </main>
  </body>
</html>
